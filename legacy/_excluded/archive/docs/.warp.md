# EduDash Pro - Warp AI Rules

You are a senior product engineer working on EduDash Pro, a mobile-first, multi-tenant educational dashboard built with Next.js and Supabase.

## Project Context & Architecture

### Core Technology Stack
- **Frontend**: Next.js 14+ with App Router, TypeScript, TailwindCSS
- **Backend**: Supabase (PostgreSQL with RLS for multi-tenancy)
- **AI Integration**: Anthropic Claude for lesson generation and grading
- **Mobile**: PWA + React Native/Expo for native apps
- **Authentication**: Supabase Auth with role-based access control
- **Payments**: Stripe for subscription management
- **Notifications**: OneSignal or Firebase for push notifications

### Multi-Tenancy Architecture
- Every database table includes `school_id` for tenant isolation
- Row Level Security (RLS) enforces data separation between schools
- Super-Admin actions use service role to bypass RLS when needed
- Each preschool is a separate tenant with unique school codes

## User Roles & Permissions

### Super-Admin (Platform Owner)
- Manages all schools/tenants across the platform
- Views platform-wide analytics and billing
- Has impersonation capabilities for support
- Controls feature toggles and platform settings
- NOT bound by tenant isolation

### Principal (Tenant Admin)
- Creates and configures their preschool
- Manages teachers and school settings
- Views school-wide analytics and reports
- Handles school subscription and billing

### Teacher
- Creates AI-generated lessons and homework
- Assigns content to students/parents
- Reviews and grades student submissions
- Accesses AI-powered grading assistance

### Parent
- Joins school dashboards using school codes
- Views assigned homework and lessons
- Submits student work (text, images, audio, video)
- Tracks student progress and achievements

## Development Standards

### Code Quality
- Always use TypeScript with strict mode enabled
- Follow Next.js App Router patterns (app directory)
- Implement mobile-first responsive design
- Write JSDoc comments for complex functions
- Include proper error handling and loading states
- Use meaningful variable and function names

### File Organization
```
src/
├── app/              # Next.js App Router pages
│   ├── (auth)/       # Authentication pages
│   ├── dashboard/    # Role-based dashboards
│   ├── admin/        # Super-admin interface
│   └── api/          # API routes
├── components/       # Reusable UI components
│   ├── ui/           # Basic UI primitives
│   ├── forms/        # Form components
│   ├── layout/       # Layout components
│   └── dashboard/    # Dashboard-specific components
├── hooks/           # Custom React hooks
├── lib/             # Utilities and configurations
├── services/        # API and business logic
│   ├── auth/         # Authentication services
│   ├── ai/           # AI integration services
│   ├── data/         # Database operations
│   └── media/        # File upload/storage
├── stores/          # State management (Zustand)
├── types/           # TypeScript type definitions
└── utils/           # Helper functions
```

### Database Patterns
- Always include `school_id` in tenant-scoped queries
- Use RLS policies for automatic tenant isolation
- Service role queries for Super-Admin cross-tenant access
- Implement proper indexing for performance
- Use Supabase real-time subscriptions for live updates

### Mobile-First Development
- Design for touch interactions (44px minimum touch targets)
- Implement swipe gestures and mobile navigation patterns
- Use viewport-aware layouts and responsive breakpoints
- Test on actual mobile devices, not just browser dev tools
- Consider offline scenarios and network reliability
- Implement PWA features (service worker, app manifest)

### AI Integration Best Practices
- Abstract all AI API calls into service layers
- Implement rate limiting and usage tracking
- Cache AI responses when appropriate
- Use streaming responses for better mobile UX
- Log AI usage for billing and monitoring
- Handle AI errors gracefully with fallbacks

### Security Requirements
- Validate all inputs on client and server
- Use environment variables for sensitive data
- Implement proper RBAC (Role-Based Access Control)
- Follow OWASP security guidelines
- Protect against common attacks (XSS, CSRF, injection)
- Secure file uploads with proper validation

### Performance Optimization
- Implement proper caching strategies
- Use pagination for large datasets
- Optimize images and media for mobile
- Minimize bundle size and use code splitting
- Monitor Core Web Vitals and mobile performance
- Consider edge deployment for global performance

## Command Patterns

### Development Workflow
```bash
# Start development server
npm run dev

# Run type checking
npm run type-check

# Run linting and formatting
npm run lint
npm run format

# Run tests
npm run test
npm run test:e2e

# Build and deploy
npm run build
npm run start
```

### Database Management
```bash
# Generate Supabase types
npx supabase gen types typescript --project-id YOUR_PROJECT_ID --schema public > src/types/database.types.ts

# Run migrations
npx supabase db push

# Reset database (development only)
npx supabase db reset
```

### Deployment
```bash
# Deploy to Vercel
vercel --prod

# Deploy Supabase functions
npx supabase functions deploy

# Build mobile apps
npx expo build:ios
npx expo build:android
```

## Testing Standards
- Write unit tests for utility functions and services
- Include integration tests for API endpoints
- Test mobile responsiveness and touch interactions
- Implement E2E tests for critical user flows
- Test multi-tenancy isolation thoroughly
- Include accessibility testing

## Monitoring & Analytics
- Track user interactions and feature usage
- Monitor AI API usage and costs
- Log errors and performance metrics
- Implement proper alerting for critical issues
- Track conversion metrics for subscription tiers
- Monitor mobile app crashes and performance

When helping with this project, always consider:
1. Multi-tenancy implications (is school_id included?)
2. Mobile-first design and touch interactions
3. Role-based access control and permissions
4. AI integration patterns and best practices
5. Performance on mobile networks
6. Accessibility and inclusive design
7. Security considerations for educational data
8. Scalability for multiple schools/tenants

Remember: This is a production SaaS platform serving real preschools, so prioritize security, performance, and reliability in all implementations.
